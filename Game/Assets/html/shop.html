<!DOCTYPE html>
<html lang="sv">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>The Shop - ARKEOLOG</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:wght@400;600&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
            }

            html,
            body {
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            body {
                font-family: "Crimson Text", serif;
                background: #0a0a0a;
                color: #d4c5a9;
                position: relative;
                overflow-y: auto;
                min-height: 100vh;
            }

            /* Background layers */
            .background {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(
                        ellipse at 50% 20%,
                        rgba(139, 90, 43, 0.15) 0%,
                        transparent 50%
                    ),
                    linear-gradient(
                        180deg,
                        #0a0a0a 0%,
                        #1a1410 50%,
                        #0a0a0a 100%
                    );
                z-index: 1;
            }

            .torch-light {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(
                    ellipse at 50% 30%,
                    rgba(255, 147, 41, 0.08) 0%,
                    transparent 60%
                );
                animation: torchFlicker 3s ease-in-out infinite;
                z-index: 2;
                pointer-events: none;
            }

            @keyframes torchFlicker {
                0%,
                100% {
                    opacity: 1;
                }
                25% {
                    opacity: 0.85;
                }
                50% {
                    opacity: 0.95;
                }
                75% {
                    opacity: 0.9;
                }
            }

            /* Content */
            .container {
                position: relative;
                z-index: 10;
                padding: 40px 20px 80px 20px;
                max-width: 1200px;
                margin: 0 auto;
            }

            .header {
                text-align: center;
                margin-bottom: 40px;
            }

            .title {
                font-family: "Cinzel", serif;
                font-size: clamp(2rem, 6vw, 3.5rem);
                font-weight: 700;
                color: #d4c5a9;
                text-shadow: 0 0 20px rgba(255, 147, 41, 0.5),
                    2px 2px 4px rgba(0, 0, 0, 0.8);
                margin-bottom: 10px;
                letter-spacing: 4px;
            }

            .subtitle {
                font-size: 1rem;
                color: #8b7355;
                font-style: italic;
                margin-bottom: 20px;
            }

            .gold-display {
                display: inline-block;
                font-family: "Cinzel", serif;
                font-size: 1.5rem;
                color: #ffd700;
                text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
                padding: 10px 20px;
                background: rgba(40, 30, 20, 0.8);
                border: 2px solid rgba(255, 215, 0, 0.5);
                border-radius: 8px;
                margin-top: 10px;
            }

            .back-button {
                position: fixed;
                top: 20px;
                left: 20px;
                font-family: "Cinzel", serif;
                font-size: 1rem;
                padding: 12px 24px;
                background: linear-gradient(
                    135deg,
                    rgba(40, 30, 20, 0.8) 0%,
                    rgba(30, 20, 15, 0.9) 100%
                );
                border: 2px solid rgba(139, 115, 85, 0.5);
                color: #d4c5a9;
                cursor: pointer;
                transition: all 0.3s ease;
                text-transform: uppercase;
                letter-spacing: 2px;
                z-index: 100;
            }

            .back-button:hover {
                border-color: rgba(255, 147, 41, 0.8);
                color: #ffd89b;
                box-shadow: 0 0 15px rgba(255, 147, 41, 0.3);
            }

            .upgrades-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
                margin-bottom: 40px;
            }

            @media (max-width: 768px) {
                .upgrades-grid {
                    grid-template-columns: 1fr;
                }
            }

            .upgrade-card {
                background: linear-gradient(
                    135deg,
                    rgba(40, 30, 20, 0.8) 0%,
                    rgba(25, 18, 12, 0.9) 100%
                );
                border: 2px solid rgba(139, 115, 85, 0.6);
                border-radius: 8px;
                padding: 16px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
                display: flex;
                flex-direction: column;
            }

            .upgrade-card:hover {
                border-color: rgba(255, 147, 41, 0.8);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.7),
                    0 0 20px rgba(255, 147, 41, 0.2);
                transform: translateY(-2px);
            }

            .upgrade-card.maxed {
                opacity: 0.6;
                border-color: rgba(100, 200, 100, 0.6);
            }

            .upgrade-card.maxed:hover {
                transform: none;
                border-color: rgba(100, 200, 100, 0.6);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            }

            .upgrade-icon {
                font-size: 2rem;
                text-align: center;
                margin-bottom: 8px;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
            }

            .upgrade-name {
                font-family: "Cinzel", serif;
                font-size: 1.1rem;
                font-weight: 600;
                color: #d4c5a9;
                text-align: center;
                margin-bottom: 8px;
                letter-spacing: 1px;
            }

            .upgrade-description {
                font-size: 0.85rem;
                color: #a8846f;
                text-align: center;
                margin-bottom: 12px;
                line-height: 1.3;
                min-height: 50px;
                flex-grow: 1;
            }

            .upgrade-level {
                text-align: center;
                font-family: "Cinzel", serif;
                font-size: 0.85rem;
                color: #8b7355;
                margin-bottom: 8px;
            }

            .upgrade-progress {
                width: 100%;
                height: 6px;
                background: rgba(20, 15, 10, 0.8);
                border-radius: 3px;
                overflow: hidden;
                margin-bottom: 10px;
            }

            .upgrade-progress-bar {
                height: 100%;
                background: linear-gradient(
                    90deg,
                    rgba(255, 147, 41, 0.8),
                    rgba(255, 193, 61, 0.8)
                );
                transition: width 0.3s ease;
                box-shadow: 0 0 10px rgba(255, 147, 41, 0.5);
            }

            .upgrade-button {
                width: 100%;
                font-family: "Cinzel", serif;
                font-size: 0.9rem;
                padding: 10px 8px;
                background: linear-gradient(
                    135deg,
                    rgba(60, 45, 30, 0.8) 0%,
                    rgba(40, 30, 20, 0.9) 100%
                );
                border: 2px solid rgba(255, 215, 0, 0.5);
                color: #ffd700;
                cursor: pointer;
                transition: all 0.3s ease;
                text-transform: uppercase;
                letter-spacing: 1px;
                border-radius: 4px;
                margin-top: auto;
            }

            .upgrade-button:hover:not(:disabled) {
                background: linear-gradient(
                    135deg,
                    rgba(80, 60, 40, 0.9) 0%,
                    rgba(60, 45, 30, 0.95) 100%
                );
                border-color: rgba(255, 215, 0, 0.8);
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
                transform: translateY(-1px);
            }

            .upgrade-button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                border-color: rgba(139, 115, 85, 0.3);
                color: #8b7355;
            }

            .category-title {
                font-family: "Cinzel", serif;
                font-size: 1.5rem;
                font-weight: 600;
                color: #d4c5a9;
                text-align: center;
                margin: 30px 0 15px 0;
                padding-bottom: 8px;
                border-bottom: 2px solid rgba(139, 115, 85, 0.5);
                text-shadow: 0 0 10px rgba(255, 147, 41, 0.3);
                letter-spacing: 2px;
            }

            .category-title:first-of-type {
                margin-top: 0;
            }
        </style>
    </head>
    <body>
        <div class="background"></div>
        <div class="torch-light"></div>

        <button class="back-button" onclick="closeShop()">‚Üê Back to Menu</button>

        <div class="container">
            <div class="header">
                <h1 class="title">THE SHOP</h1>
                <p class="subtitle">
                    "Trade your ill-gotten gains for power... if you dare"
                </p>
                <div class="gold-display">üí∞ <span id="goldAmount">0</span> Gold</div>
            </div>

            <h2 class="category-title">‚öîÔ∏è Core Upgrades</h2>
            <div class="upgrades-grid" id="coreUpgrades"></div>

            <h2 class="category-title">üõ°Ô∏è Curse Resistances</h2>
            <div class="upgrades-grid" id="curseResistances"></div>

            <h2 class="category-title">‚ú® Special Abilities</h2>
            <div class="upgrades-grid" id="specialAbilities"></div>
        </div>

        <script>
            // Upgrade definitions
            const upgrades = {
                core: [
                    {
                        id: "protectionCharms",
                        name: "Protection Charms",
                        icon: "üõ°Ô∏è",
                        description: "Increase your total protection charms",
                        basePrice: 50000,
                        priceIncrease: 1.5,
                        maxLevel: 5,
                        effect: (level) => `+${level} charms`,
                    },
                    {
                        id: "moveSpeed",
                        name: "Swift Feet",
                        icon: "üëü",
                        description: "Increase your base movement speed",
                        basePrice: 40000,
                        priceIncrease: 1.5,
                        maxLevel: 5,
                        effect: (level) => `+${level * 5}% move speed`,
                    },
                    {
                        id: "torchPower",
                        name: "Brighter Torch",
                        icon: "üî•",
                        description: "Improve your torch light radius",
                        basePrice: 35000,
                        priceIncrease: 1.4,
                        maxLevel: 5,
                        effect: (level) => `+${level * 8}% light radius`,
                    },
                ],
                curseResistance: [
                    {
                        id: "speedResistance",
                        name: "Lethargy Ward",
                        icon: "‚ö°",
                        description: "Reduce the effect of speed curses",
                        basePrice: 40000,
                        priceIncrease: 1.5,
                        maxLevel: 3,
                        effect: (level) => `${level * 10}% speed curse reduction`,
                    },
                    {
                        id: "torchResistance",
                        name: "Light Blessing",
                        icon: "üí°",
                        description: "Reduce the effect of darkness curses",
                        basePrice: 40000,
                        priceIncrease: 1.5,
                        maxLevel: 3,
                        effect: (level) => `${level * 10}% darkness curse reduction`,
                    },
                    {
                        id: "sightResistance",
                        name: "Clear Vision",
                        icon: "üëÅÔ∏è",
                        description: "Reduce the effect of blindness curses",
                        basePrice: 40000,
                        priceIncrease: 1.5,
                        maxLevel: 3,
                        effect: (level) => `${level * 10}% sight curse reduction`,
                    },
                    {
                        id: "hauntResistance",
                        name: "Spirit Ward",
                        icon: "üëª",
                        description: "Ghosts spawn slower and move slower",
                        basePrice: 60000,
                        priceIncrease: 1.6,
                        maxLevel: 3,
                        effect: (level) => `${level * 10}% ghost slowdown`,
                    },
                ],
                special: [
                    {
                        id: "luckyFind",
                        name: "Lucky Charm",
                        icon: "üçÄ",
                        description: "Higher chance to find rare artifacts",
                        basePrice: 80000,
                        priceIncrease: 2.0,
                        maxLevel: 3,
                        effect: (level) => `+${level * 10}% rarity chance`,
                    },
                    {
                        id: "goldBonus",
                        name: "Treasure Hunter",
                        icon: "üíé",
                        description: "Artifacts are worth more gold",
                        basePrice: 50000,
                        priceIncrease: 1.8,
                        maxLevel: 5,
                        effect: (level) => `+${level * 15}% artifact value`,
                    },
                    {
                        id: "fearAura",
                        name: "Intimidating Presence",
                        icon: "üòà",
                        description: "Ghosts keep their distance from you",
                        basePrice: 100000,
                        priceIncrease: 2.5,
                        maxLevel: 2,
                        effect: (level) => `Ghosts stay ${level * 2}m further away`,
                    },
                    {
                        id: "secondChance",
                        name: "Death Ward",
                        icon: "üíÄ",
                        description: "Survive a fatal hit once per expedition",
                        basePrice: 150000,
                        priceIncrease: 3.0,
                        maxLevel: 1,
                        effect: (level) => level > 0 ? "Active" : "Inactive",
                    },
                ],
            };

            function getUpgradeLevel(upgradeId) {
                return parseInt(localStorage.getItem(`upgrade_${upgradeId}`) || "0");
            }

            function setUpgradeLevel(upgradeId, level) {
                localStorage.setItem(`upgrade_${upgradeId}`, level.toString());
            }

            function getGold() {
                return parseInt(localStorage.getItem("totalValue") || "0");
            }

            function setGold(amount) {
                localStorage.setItem("totalValue", amount.toString());
                updateGoldDisplay();
            }

            function updateGoldDisplay() {
                document.getElementById("goldAmount").textContent = getGold().toLocaleString();
            }

            function calculatePrice(upgrade, currentLevel) {
                if (currentLevel >= upgrade.maxLevel) return 0;
                return Math.floor(
                    upgrade.basePrice * Math.pow(upgrade.priceIncrease, currentLevel)
                );
            }

            function createUpgradeCard(upgrade) {
                const currentLevel = getUpgradeLevel(upgrade.id);
                const isMaxed = currentLevel >= upgrade.maxLevel;
                const price = calculatePrice(upgrade, currentLevel);
                const canAfford = getGold() >= price;

                const card = document.createElement("div");
                card.className = `upgrade-card ${isMaxed ? "maxed" : ""}`;
                card.innerHTML = `
                    <div class="upgrade-icon">${upgrade.icon}</div>
                    <div class="upgrade-name">${upgrade.name}</div>
                    <div class="upgrade-description">${upgrade.description}</div>
                    <div class="upgrade-level">
                        Level ${currentLevel} / ${upgrade.maxLevel}
                    </div>
                    <div class="upgrade-progress">
                        <div class="upgrade-progress-bar" style="width: ${
                            (currentLevel / upgrade.maxLevel) * 100
                        }%"></div>
                    </div>
                    <div style="text-align: center; margin-bottom: 10px; color: #8b7355; font-size: 0.9rem;">
                        ${upgrade.effect(currentLevel)}
                    </div>
                    <button
                        class="upgrade-button"
                        onclick="purchaseUpgrade('${upgrade.id}')"
                        ${isMaxed || !canAfford ? "disabled" : ""}
                    >
                        ${
                            isMaxed
                                ? "MAXED OUT"
                                : `${canAfford ? "Purchase" : "Too Expensive"} - ${price.toLocaleString()}g`
                        }
                    </button>
                `;
                return card;
            }

            function purchaseUpgrade(upgradeId) {
                // Find the upgrade definition
                let upgrade = null;
                for (const category of Object.values(upgrades)) {
                    const found = category.find((u) => u.id === upgradeId);
                    if (found) {
                        upgrade = found;
                        break;
                    }
                }

                if (!upgrade) return;

                const currentLevel = getUpgradeLevel(upgradeId);
                const price = calculatePrice(upgrade, currentLevel);
                const gold = getGold();

                if (currentLevel >= upgrade.maxLevel) {
                    return; // Already maxed
                }

                if (gold < price) {
                    return; // Can't afford
                }

                // Purchase successful
                setGold(gold - price);
                setUpgradeLevel(upgradeId, currentLevel + 1);

                // Refresh all cards
                renderShop();
            }

            function renderShop() {
                const coreContainer = document.getElementById("coreUpgrades");
                const curseContainer = document.getElementById("curseResistances");
                const specialContainer = document.getElementById("specialAbilities");

                coreContainer.innerHTML = "";
                curseContainer.innerHTML = "";
                specialContainer.innerHTML = "";

                upgrades.core.forEach((upgrade) => {
                    coreContainer.appendChild(createUpgradeCard(upgrade));
                });

                upgrades.curseResistance.forEach((upgrade) => {
                    curseContainer.appendChild(createUpgradeCard(upgrade));
                });

                upgrades.special.forEach((upgrade) => {
                    specialContainer.appendChild(createUpgradeCard(upgrade));
                });

                updateGoldDisplay();
            }

            function closeShop() {
                if (window.parent && window.parent.closeShop) {
                    window.parent.closeShop();
                }
            }

            // Initialize shop
            renderShop();
        </script>
    </body>
</html>
